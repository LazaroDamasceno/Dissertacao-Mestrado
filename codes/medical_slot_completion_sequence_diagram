@startuml

skinparam defaultFontSize 60

participant "Client"
participant "Input"
participant "DoctorFinder"
participant "MedicalSlotFinder"
participant "Repository"
participant "ResponseEntity"

Client -> ResponseEntity: HTTP 1.1 patch /api/v2/medical_slots/{license_number}/{state}/{medical_slot_id}/completion

alt default behavior

Input -> DoctorFinder: pass license_number as argument

Input -> DoctorFinder: pass state as argument

DoctorFinder -> DoctorFinder: retrieve doctor

DoctorFinder -> MedicalSlotFinder: pass doctor as argument

Input -> MedicalSlotFinder: pass medical_slot_id as argument

MedicalSlotFinder -> MedicalSlotFinder: retrieve medical slot

MedicalSlotFinder -> MedicalSlotFinder: markAsCompleted(MedicalSlot)

MedicalSlotFinder <-- Repository: save(MedicalSlot)

MedicalSlotFinder -> ResponseEntity: wrapWith204(MedicalSlot)

Client <-- ResponseEntity: HTTP 1.1 204 NO CONTENT

else doctor not found

MedicalSlotFinder -> ResponseEntity: wrapWith404(Doctor)

Client <-- ResponseEntity: HTTP 1.1 404 NO FOUND

else medical slot not found

MedicalSlotFinder -> ResponseEntity: wrapWith404(MedicalSlot)

Client <-- ResponseEntity: HTTP 1.1 404 NO FOUND

else canceled medical slot

MedicalSlotFinder -> ResponseEntity: wrapWith409(MedicalSlot)

Client <-- ResponseEntity: HTTP 1.1 409 CONFLICT

end

@enduml
